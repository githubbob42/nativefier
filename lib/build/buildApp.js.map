{"version":3,"sources":["build/buildApp.js"],"names":["copy","ncp","selectAppArgs","options","appCopyright","appVersion","buildVersion","win32metadata","versionString","name","targetUrl","counter","width","height","minWidth","minHeight","maxWidth","maxHeight","showMenuBar","fastQuit","userAgent","nativefierVersion","ignoreCertificate","ignoreGpuBlacklist","enableEs3Apis","insecure","flashPluginDir","diskCacheSize","fullScreen","hideWindowFrame","maximize","disableContextMenu","disableDevTools","zoom","internalUrls","crashReporter","singleInstance","processEnvs","maybeCopyScripts","srcs","dest","Promise","resolve","promises","map","reject","existsSync","src","destFileName","extname","join","error","all","then","catch","normalizeAppName","appName","url","hash","createHash","update","postFixHash","digest","substring","normalized","kebabCase","toLowerCase","changeAppPackageJsonName","appPath","packageJsonPath","packageJson","JSON","parse","readFileSync","writeFileSync","stringify","buildApp","callback","appArgs","inject","console","warn"],"mappings":"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","file":"buildApp.js","sourcesContent":["import fs from 'fs';\nimport crypto from 'crypto';\nimport _ from 'lodash';\nimport path from 'path';\nimport ncp from 'ncp';\n\nconst copy = ncp.ncp;\n\n/**\n * Only picks certain app args to pass to nativefier.json\n * @param options\n */\nfunction selectAppArgs(options) {\n  return {\n    appCopyright: options['appCopyright'],\n    appVersion: options['appVersion'],\n    buildVersion: options['buildVersion'],\n    win32metadata: options.win32metadata,\n    versionString: options['versionString'],\n    name: options.name,\n    targetUrl: options.targetUrl,\n    counter: options.counter,\n    width: options.width,\n    height: options.height,\n    minWidth: options.minWidth,\n    minHeight: options.minHeight,\n    maxWidth: options.maxWidth,\n    maxHeight: options.maxHeight,\n    showMenuBar: options.showMenuBar,\n    fastQuit: options.fastQuit,\n    userAgent: options.userAgent,\n    nativefierVersion: options.nativefierVersion,\n    ignoreCertificate: options.ignoreCertificate,\n    ignoreGpuBlacklist: options.ignoreGpuBlacklist,\n    enableEs3Apis: options.enableEs3Apis,\n    insecure: options.insecure,\n    flashPluginDir: options.flashPluginDir,\n    diskCacheSize: options.diskCacheSize,\n    fullScreen: options.fullScreen,\n    hideWindowFrame: options.hideWindowFrame,\n    maximize: options.maximize,\n    disableContextMenu: options.disableContextMenu,\n    disableDevTools: options.disableDevTools,\n    zoom: options.zoom,\n    internalUrls: options.internalUrls,\n    crashReporter: options.crashReporter,\n    singleInstance: options.singleInstance,\n    processEnvs: options.processEnvs,\n  };\n}\n\nfunction maybeCopyScripts(srcs, dest) {\n  if (!srcs) {\n    return new Promise((resolve) => {\n      resolve();\n    });\n  }\n  const promises = srcs.map(src => new Promise((resolve, reject) => {\n    if (!fs.existsSync(src)) {\n      reject('Error copying injection files: file not found');\n      return;\n    }\n\n    let destFileName;\n    if (path.extname(src) === '.js') {\n      destFileName = 'inject.js';\n    } else if (path.extname(src) === '.css') {\n      destFileName = 'inject.css';\n    } else {\n      resolve();\n      return;\n    }\n\n    copy(src, path.join(dest, 'inject', destFileName), (error) => {\n      if (error) {\n        reject(`Error Copying injection files: ${error}`);\n        return;\n      }\n      resolve();\n    });\n  }));\n\n  return new Promise((resolve, reject) => {\n    Promise.all(promises)\n      .then(() => {\n        resolve();\n      })\n      .catch((error) => {\n        reject(error);\n      });\n  });\n}\n\nfunction normalizeAppName(appName, url) {\n    // use a simple 3 byte random string to prevent collision\n  const hash = crypto.createHash('md5');\n  hash.update(url);\n  const postFixHash = hash.digest('hex').substring(0, 6);\n  const normalized = _.kebabCase(appName.toLowerCase());\n  return `${normalized}-nativefier-${postFixHash}`;\n}\n\nfunction changeAppPackageJsonName(appPath, name, url) {\n  const packageJsonPath = path.join(appPath, '/package.json');\n  const packageJson = JSON.parse(fs.readFileSync(packageJsonPath));\n  packageJson.name = normalizeAppName(name, url);\n  fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson));\n}\n\n/**\n * Creates a temporary directory and copies the './app folder' inside,\n * and adds a text file with the configuration for the single page app.\n *\n * @param {string} src\n * @param {string} dest\n * @param {{}} options\n * @param callback\n */\nfunction buildApp(src, dest, options, callback) {\n  const appArgs = selectAppArgs(options);\n  copy(src, dest, (error) => {\n    if (error) {\n      callback(`Error Copying temporary directory: ${error}`);\n      return;\n    }\n\n    fs.writeFileSync(path.join(dest, '/nativefier.json'), JSON.stringify(appArgs));\n\n    maybeCopyScripts(options.inject, dest)\n      .catch((error) => {\n        console.warn(error);\n      })\n      .then(() => {\n        changeAppPackageJsonName(dest, appArgs.name, appArgs.targetUrl);\n        callback();\n      });\n  });\n}\n\n\nexport default buildApp;\n"]}